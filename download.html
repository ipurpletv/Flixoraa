<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Download - Flixora</title>
  <style>
    body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#111;color:#fff;text-align:center}
    .navbar{background:#000;padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #222}
    .logo{font-size:1.5rem;font-weight:bold;color:#e50914;text-decoration:none}
    .back-btn{background:#e50914;color:#fff;padding:8px 16px;border-radius:4px;text-decoration:none;font-weight:bold}
    .content{padding:3rem 1rem}
    #poster{max-width:200px;border-radius:8px;margin-bottom:1rem;display:none}
    #download-title{font-size:1.8rem;margin-bottom:1rem}
    #countdown{font-size:1.2rem;color:#aaa}
    #download-link{display:none;margin-top:2rem;background:#e50914;color:#fff;padding:12px 24px;border:none;border-radius:5px;font-weight:bold;text-decoration:none}
  </style>
</head>
<body>

  <!-- Navbar -->
  <div class="navbar">
    <a href="index.html" class="logo">Flixora</a>
    <a href="index.html" class="back-btn">Back to Homepage</a>
  </div>

  <!-- Page Content -->
  <div class="content">
    <img id="poster" alt="Poster">
    <h1 id="download-title">Preparing downloadâ€¦</h1>
    <p id="countdown">Your download will be ready in <span id="timer">10</span>â€¯secondsâ€¦</p>
    <a id="download-link" target="_blank">DownloadÂ Now</a>
  </div>

  <script>
    /* --- CONFIG --- */
    const API_KEY = 'ba0e2f64d29bae320cf0bbd091bbdf3f';
    const IMG_URL = 'https://image.tmdb.org/t/p/w500';

    /* ðŸ”´  Map TMDB ID âžœ actual file URL */
    const downloadLinks = {
      '609681': 'https://dl.example.com/The_Marvels_2023.mp4',
      '123456': 'https://example.com/anotherâ€‘movie.mp4',
      '999999': 'https://example.com/sampleâ€‘tvâ€‘show.mp4'
      // add more here
    };

    /* --- Grab query params --- */
    const qs   = new URLSearchParams(location.search);
    const id   = qs.get('id');             // required
    const type = qs.get('type') || 'movie';// default 'movie'

    /* --- DOM refs --- */
    const poster   = document.getElementById('poster');
    const h1       = document.getElementById('download-title');
    const cdWrap   = document.getElementById('countdown');
    const timer    = document.getElementById('timer');
    const dlBtn    = document.getElementById('download-link');

    /* --- Main flow --- */
    (async () => {
      /* 1. Look up manual link */
      const fileURL = downloadLinks[id];
      if (!id || !fileURL) {
        h1.textContent = 'Download link not available.';
        cdWrap.style.display = 'none';
        return;
      }

      /* 2. Fetch poster + title from TMDB */
      try {
        const res  = await fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${API_KEY}`);
        const data = await res.json();
        h1.textContent = `Download: ${data.title || data.name || 'Unknown Title'}`;
        if (data.poster_path) {
          poster.src = IMG_URL + data.poster_path;
          poster.style.display = 'block';
        }
      } catch(e){
        console.warn('TMDB fetch failed', e);
      }

      /* 3. 10â€‘second countdown then reveal button */
      let sec = 10;
      const tick = setInterval(() => {
        timer.textContent = --sec;
        if (sec < 0) {
          clearInterval(tick);
          cdWrap.style.display = 'none';
          dlBtn.href = fileURL;
          dlBtn.style.display = 'inline-block';
        }
      }, 1000);
    })();
  </script>

</body>
</html>
