<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PurpleTin • Home</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- █ NAV BAR █ -->
  <nav class="main-nav">
    <a class="nav-brand" href="#">PurpleTin</a>
    <div class="nav-links">
      <a href="#animations">Animations</a>
      <a href="#movies">Movies</a>
      <a href="#tv">TV Series</a>
      <a href="#anime">Anime</a>
      <a href="#kdrama">K‑Drama</a>
    </div>
    <input id="searchInput" type="search" placeholder="Search…" autocomplete="off">
  </nav>

  <!-- █ HERO BANNER █ -->
  <header class="hero-banner" id="heroBanner"></header>

  <!-- █ CONTENT SECTIONS █ -->
  <main>
    <!-- sections identical to previous version omitted for brevity -->
  </main>

  <footer class="site-footer">© 2025 PurpleTin</footer>

  <div id="modal" class="modal">
    <div class="modal-content">
      <span id="modalClose" class="close">&times;</span>
      <div id="modalBody"></div>
    </div>
  </div>

  <script>
    /* === CONFIGURATION === */
    const TMDB_API_KEY = 'b139bc417606842811f1526ae92572bc';

    // Content categories (same as before)
    const CATEGORIES = {
      animations:{rowId:'row-ani',imdbIds:['tt2953050']},
      movies:{rowId:'row-mov',imdbIds:['tt6208148']},
      tv:{rowId:'row-tv',imdbIds:['tt4574334']},
      anime:{rowId:'row-anime',imdbIds:['tt8580274']},
      kdrama:{rowId:'row-k',imdbIds:['tt10262630']}
    };

    const STREAM_MAP={
      tt2953050:'https://your-stream.com/encanto.mp4',
      tt6208148:'https://your-stream.com/snowwhite.mp4',
      tt4574334:'https://your-stream.com/strangerthings.mp4',
      tt8580274:'https://your-stream.com/demonslayer.mp4',
      tt10262630:'https://your-stream.com/crashlanding.mp4'
    };

    // Banner will randomly rotate through these IMDb IDs
    const BANNER_IDS=['tt6208148','tt2953050','tt4574334','tt8580274','tt10262630'];

    /* === HELPERS === */
    const $=sel=>document.querySelector(sel);
    const fetchJSON=url=>fetch(url).then(r=>r.json());

    async function fetchDetailsByIMDb(id){
      const findURL=`https://api.themoviedb.org/3/find/${id}?api_key=${TMDB_API_KEY}&external_source=imdb_id`;
      const find=await fetchJSON(findURL);
      const arr=find.movie_results.length?find.movie_results:find.tv_results;
      if(!arr.length) return null;
      const media=arr[0];
      const tmdbId=media.id;
      const type=find.movie_results.length?'movie':'tv';
      const detail=await fetchJSON(`https://api.themoviedb.org/3/${type}/${tmdbId}?api_key=${TMDB_API_KEY}&language=en-US`);
      return{type,detail,imdbId:id};
    }

    function createCard({detail,type,imdbId}){
      const title=type==='movie'?detail.title:detail.name;
      const rating=detail.vote_average.toFixed(1);
      const release=(detail.release_date||detail.first_air_date||'').slice(0,4);
      const genres=detail.genres.map(g=>g.name).join(', ');
      const poster=`https://image.tmdb.org/t/p/w342${detail.poster_path}`;
      const overview=detail.overview;
      const stream=STREAM_MAP[imdbId]||'#';
      const art=document.createElement('article');
      art.className='card';
      Object.assign(art.dataset,{title,rating,release,genre:genres,overview,poster,stream});
      art.innerHTML=`<img src="${poster}" alt="${title}"><h3>${title}</h3><span class="rating">⭐ ${rating}</span><a href="#" class="watch-btn">Watch</a>`;
      return art;
    }

    async function populateCategory(key){
      const {rowId,imdbIds}=CATEGORIES[key];
      const row=document.getElementById(rowId);
      for(const id of imdbIds){
        const data=await fetchDetailsByIMDb(id);
        if(data) row.appendChild(createCard(data));
      }
    }

    async function initAllCategories(){
      for(const key of Object.keys(CATEGORIES)) await populateCategory(key);
    }

    /* === BANNER BUILD & RANDOM ROTATION === */
    async function buildBannerSlides(){
      const hero=$('#heroBanner');
      const slidePromises=BANNER_IDS.map(fetchDetailsByIMDb);
      const results=await Promise.all(slidePromises);
      results.filter(Boolean).forEach((data,i)=>{
        const {detail,imdbId}=data;
        const title=detail.title||detail.name;
        const img=`https://image.tmdb.org/t/p/original${detail.backdrop_path||detail.poster_path}`;
        const slide=document.createElement('div');
        slide.className='slide'+(i===0?' active':'');
        slide.dataset.stream=STREAM_MAP[imdbId]||'#';
        slide.innerHTML=`<img src="${img}" alt="${title}"><div class="banner-overlay"><h1>${title}</h1><p class="banner-rating">⭐ ${detail.vote_average.toFixed(1)} | ${(detail.release_date||detail.first_air_date||'').slice(0,4)}</p><p class="banner-overview">${detail.overview}</p><a class="banner-watch" href="watch.html?title=${encodeURIComponent(title)}&src=${encodeURIComponent(STREAM_MAP[imdbId]||'#')}">Watch</a></div>`;
        hero.appendChild(slide);
      });
      startRandomRotation();
    }

    function startRandomRotation(){
      const slides=[...document.querySelectorAll('#heroBanner .slide')];
      if(slides.length<2) return;
      let current=0;
      setInterval(()=>{
        slides[current].classList.remove('active');
        let next;
        do{next=Math.floor(Math.random()*slides.length);}while(next===current);
        current=next;
        slides[current].classList.add('active');
      },10000);
    }

    /* === SEARCH, MODAL & UTILITY === */
    const amt=360;
    window.scrollLeft=id=>document.getElementById(id).scrollBy({left:-amt,behavior:'smooth'});
    window.scrollRight=id=>document.getElementById(id).scrollBy({left:amt,behavior:'smooth'});

    $('#searchInput').addEventListener('input',e=>{
      const q=e.target.value.toLowerCase().trim();
      document.querySelectorAll('.card').forEach(c=>c.style.display=c.dataset.title.toLowerCase().includes(q)?'':'none');
    });

    const modal=$('#modal');
    $('#modalClose').onclick=()=>modal.style.display='none';
    window.onclick=e=>(e.target===modal)&&(modal.style.display='none');
    document.addEventListener('click',e=>{
      if(e.target.matches('.watch-btn')){
        e.preventDefault();
        const d=e.target.closest('.card').dataset;
        $('#modalBody').innerHTML=`<div class="modal-flex"><img src="${d.poster}" alt="${d.title}"><div class="modal-info"><h2>${d.title}</h2><p><strong>Rating:</strong> ${d.rating}/10</p><p><strong>Release:</strong> ${d.release}</p><p><strong>Genre:</strong> ${d.genre}</p><p class="overview">${d.overview}</p><a class="watch-now" href="watch.html?title=${encodeURIComponent(d.title)}&src=${encodeURIComponent(d.stream)}" target="_blank">Watch Now</a></div></div>`;
        modal.style.display='flex';
      }
    });

    /* === INITIALISE EVERYTHING === */
    (async()=>{
      await Promise.all([initAllCategories(),buildBannerSlides()]);
    })();
  </script>
</body>
</html>
