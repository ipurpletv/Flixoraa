<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PurpleTin • Home</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- █ NAV BAR █ -->
  <nav class="main-nav">
    <a class="nav-brand" href="#">PurpleTin</a>
    <div class="nav-links">
      <a href="#animations">Animations</a>
      <a href="#movies">Movies</a>
      <a href="#tv">TV Series</a>
      <a href="#anime">Anime</a>
      <a href="#kdrama">K‑Drama</a>
    </div>
    <input id="searchInput" type="search" placeholder="Search…" autocomplete="off">
  </nav>

  <!-- █ HERO BANNER █ -->
  <header class="hero-banner" id="heroBanner"></header>

  <!-- █ CONTENT SECTIONS █ -->
  <main>
    <!-- Animations -->
    <section id="animations" class="carousel-section">
      <h2 class="section-title">Animations</h2>
      <div class="carousel-wrap">
        <button class="arrow left" onclick="scrollLeft('row-ani')">&#10094;</button>
        <div class="carousel-row" id="row-ani"></div>
        <button class="arrow right" onclick="scrollRight('row-ani')">&#10095;</button>
      </div>
    </section>

    <!-- Movies -->
    <section id="movies" class="carousel-section">
      <h2 class="section-title">Movies</h2>
      <div class="carousel-wrap">
        <button class="arrow left" onclick="scrollLeft('row-mov')">&#10094;</button>
        <div class="carousel-row" id="row-mov"></div>
        <button class="arrow right" onclick="scrollRight('row-mov')">&#10095;</button>
      </div>
    </section>

    <!-- TV Series -->
    <section id="tv" class="carousel-section">
      <h2 class="section-title">TV Series</h2>
      <div class="carousel-wrap">
        <button class="arrow left" onclick="scrollLeft('row-tv')">&#10094;</button>
        <div class="carousel-row" id="row-tv"></div>
        <button class="arrow right" onclick="scrollRight('row-tv')">&#10095;</button>
      </div>
    </section>

    <!-- Anime -->
    <section id="anime" class="carousel-section">
      <h2 class="section-title">Anime</h2>
      <div class="carousel-wrap">
        <button class="arrow left" onclick="scrollLeft('row-anime')">&#10094;</button>
        <div class="carousel-row" id="row-anime"></div>
        <button class="arrow right" onclick="scrollRight('row-anime')">&#10095;</button>
      </div>
    </section>

    <!-- K‑Drama -->
    <section id="kdrama" class="carousel-section">
      <h2 class="section-title">K‑Drama</h2>
      <div class="carousel-wrap">
        <button class="arrow left" onclick="scrollLeft('row-k')">&#10094;</button>
        <div class="carousel-row" id="row-k"></div>
        <button class="arrow right" onclick="scrollRight('row-k')">&#10095;</button>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="site-footer">© 2025 PurpleTin</footer>

  <!-- MODAL -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <span id="modalClose" class="close">&times;</span>
      <div id="modalBody"></div>
    </div>
  </div>

  <!-- ░░░ SCRIPTS ░░░ -->
  <script>
    /* === CONFIGURATION === */
    const TMDB_API_KEY = 'b139bc417606842811f1526ae92572bc';   // ❶ PUT YOUR KEY HERE

    // ❷ Minimal data you supply → everything else loads automatically
    const CATEGORIES = {
      animations: {
        rowId: 'row-ani',
        imdbIds: ['tt2953050'] // Encanto
      },
      movies: {
        rowId: 'row-mov',
        imdbIds: ['tt6208148'] // Snow White
      },
      tv: {
        rowId: 'row-tv',
        imdbIds: ['tt4574334'] // Stranger Things
      },
      anime: {
        rowId: 'row-anime',
        imdbIds: ['tt8580274'] // Demon Slayer (movie id also ok)
      },
      kdrama: {
        rowId: 'row-k',
        imdbIds: ['tt10262630'] // Crash Landing on You
      }
    };

    // optional – map an IMDb id (or title) to your own stream url
    const STREAM_MAP = {
      tt2953050: 'https://your-stream.com/encanto.mp4',
      tt6208148: 'https://your-stream.com/snowwhite.mp4',
      tt4574334: 'https://your-stream.com/strangerthings.mp4',
      tt8580274: 'https://your-stream.com/demonslayer.mp4',
      tt10262630: 'https://your-stream.com/crashlanding.mp4'
    };

    /* === HELPERS === */
    const $ = sel => document.querySelector(sel);

    const fetchJSON = url => fetch(url).then(r => r.json());

    async function fetchDetailsByIMDb(id) {
      // 1) /find to get TMDb ID & media type
      const findURL = `https://api.themoviedb.org/3/find/${id}?api_key=${TMDB_API_KEY}&external_source=imdb_id`;
      const findData = await fetchJSON(findURL);
      const mediaArr = findData.movie_results.length ? findData.movie_results : findData.tv_results;
      if (!mediaArr.length) return null;
      const media = mediaArr[0];
      const tmdbId = media.id;
      const type = findData.movie_results.length ? 'movie' : 'tv';

      // 2) get full details (for genre names, runtime, etc.)
      const detailURL = `https://api.themoviedb.org/3/${type}/${tmdbId}?api_key=${TMDB_API_KEY}&language=en-US`;
      const detail = await fetchJSON(detailURL);
      return { type, detail, imdbId: id };
    }

    function createCard({ detail, type, imdbId }) {
      const title   = type === 'movie' ? detail.title : detail.name;
      const rating  = detail.vote_average.toFixed(1);
      const release = (detail.release_date || detail.first_air_date || '').slice(0,4);
      const genres  = detail.genres.map(g => g.name).join(', ');
      const poster  = `https://image.tmdb.org/t/p/w342${detail.poster_path}`;
      const overview= detail.overview;
      const stream  = STREAM_MAP[imdbId] || '#';

      const art = document.createElement('article');
      art.className = 'card';
      art.dataset.title   = title;
      art.dataset.rating  = rating;
      art.dataset.release = release;
      art.dataset.genre   = genres;
      art.dataset.overview= overview;
      art.dataset.poster  = poster;
      art.dataset.stream  = stream;
      art.innerHTML = `
        <img src="${poster}" alt="${title}">
        <h3>${title}</h3>
        <span class="rating">⭐ ${rating}</span>
        <a href="#" class="watch-btn">Watch</a>`;
      return art;
    }

    async function populateCategory(catKey) {
      const { rowId, imdbIds } = CATEGORIES[catKey];
      const row = document.getElementById(rowId);
      for (const id of imdbIds) {
        const data = await fetchDetailsByIMDb(id);
        if (data) row.appendChild(createCard(data));
      }
    }

    async function initAllCategories() {
      for (const key of Object.keys(CATEGORIES)) {
        await populateCategory(key);
      }
    }

    /* === HERO BANNER === */
    async function loadBanner(imdbId) {
      const data = await fetchDetailsByIMDb(imdbId);
      if (!data) return;
      const { detail } = data;
      const title = detail.title || detail.name;
      const backdrop = `https://image.tmdb.org/t/p/original${detail.backdrop_path || detail.poster_path}`;
      $('#heroBanner').innerHTML = `
        <div class="slide active" data-title="${title}" data-stream="${STREAM_MAP[imdbId] || '#'}">
          <img src="${backdrop}" alt="${title}">
          <div class="banner-overlay">
            <h1>${title}</h1>
            <p class="banner-rating">⭐ ${detail.vote_average.toFixed(1)}  |  ${(detail.release_date||detail.first_air_date||'').slice(0,4)}</p>
            <p class="banner-overview">${detail.overview}</p>
            <a class="banner-watch" href="watch.html?title=${encodeURIComponent(title)}&src=${encodeURIComponent(STREAM_MAP[imdbId]||'#')}">Watch</a>
          </div>
        </div>`;
    }

    /* === MODAL, SEARCH, CAROUSEL === */
    const amt = 360;
    window.scrollLeft  = id => document.getElementById(id).scrollBy({left:-amt,behavior:'smooth'});
    window.scrollRight = id => document.getElementById(id).scrollBy({left: amt,behavior:'smooth'});

    const searchInput = $('#searchInput');
    searchInput.addEventListener('input', () => {
      const q = searchInput.value.toLowerCase().trim();
      document.querySelectorAll('.card').forEach(c => c.style.display = c.dataset.title.toLowerCase().includes(q) ? '' : 'none');
    });

    const modal = $('#modal');
    $('#modalClose').onclick = () => modal.style.display='none';
    window.onclick = e => (e.target===modal)&&(modal.style.display='none');
    document.addEventListener('click',e=>{
      if(e.target.matches('.watch-btn')){
        e.preventDefault();
        const d=e.target.closest('.card').dataset;
        $('#modalBody').innerHTML=`<div class="modal-flex"><img src="${d.poster}" alt="${d.title}"><div class="modal-info"><h2>${d.title}</h2><p><strong>Rating:</strong> ${d.rating}/10</p><p><strong>Release:</strong> ${d.release}</p><p><strong>Genre:</strong> ${d.genre}</p><p class="overview">${d.overview}</p><a class="watch-now" href="watch.html?title=${encodeURIComponent(d.title)}&src=${encodeURIComponent(d.stream)}" target="_blank">Watch Now</a></div></div>`;
        modal.style.display='flex';
      }
    });

    /* === INITIALISE === */
    (async()=>{
      await initAllCategories();                // load cards automatically
      await loadBanner('tt6208148');            // banner movie (Snow White)
    })();
  </script>
</body>
</html>
