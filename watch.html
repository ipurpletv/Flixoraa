<!-- Place this just before </body> in your existing watch.html -->
<!-- ===== GLOBAL CHAT WIDGET (START) ===== -->
<style>
  #chat-toggle {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #00bfff;
    color: #fff;
    border: none;
    border-radius: 20px;
    padding: 10px 14px;
    cursor: pointer;
    z-index: 9999;
  }

  #chat-box {
    position: fixed;
    bottom: 70px;
    right: 20px;
    width: 300px;
    max-height: 400px;
    background: #111;
    border: 1px solid #444;
    border-radius: 10px;
    display: none;
    flex-direction: column;
    z-index: 9999;
  }

  #chat-header {
    background: #222;
    padding: 8px 12px;
    font-weight: bold;
    border-bottom: 1px solid #333;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  #chat-messages {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    font-size: 0.9rem;
  }

  #chat-messages p {
    margin-bottom: 8px;
    word-wrap: break-word;
  }

  #chat-input {
    display: flex;
    border-top: 1px solid #333;
  }

  #chat-input input {
    flex: 1;
    padding: 8px;
    background: #222;
    border: none;
    color: #fff;
    font-size: 0.85rem;
  }

  #chat-input button {
    padding: 8px 12px;
    background: #00bfff;
    border: none;
    color: #fff;
    font-weight: bold;
    cursor: pointer;
  }

  #chat-login {
    padding: 10px;
    text-align: center;
  }

  .chat-timestamp {
    font-size: 0.75rem;
    color: #777;
    margin-left: 5px;
  }
</style>

<button id="chat-toggle">ðŸ’¬ Chat</button>

<div id="chat-box">
  <div id="chat-header">
    Global Chat <span id="chat-users" style="font-weight:normal;font-size:0.85rem;"></span>
  </div>
  <div id="chat-messages">Loading chatâ€¦</div>
  <div id="chat-input" style="display:none;">
    <input type="text" id="chat-text" placeholder="Type a message..." />
    <button id="chat-send">Send</button>
  </div>
  <div id="chat-login">
    <button id="chat-login-btn">Sign in with Google</button>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

<script>
  // Firebase Config (Replace with your own config if needed)
  const firebaseConfig = {
    apiKey: "AIzaSyAp-Izn4Cnk-9A1OZcYqob4IkBTaOazbNc",
    authDomain: "flixora-chat.firebaseapp.com",
    databaseURL: "https://flixora-chat-default-rtdb.firebaseio.com",
    projectId: "flixora-chat",
    storageBucket: "flixora-chat.appspot.com",
    messagingSenderId: "663750708652",
    appId: "1:663750708652:web:f3f4cf4c2a44571cf2c4fb"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  const toggleBtn = document.getElementById('chat-toggle');
  const chatBox = document.getElementById('chat-box');
  const loginBtn = document.getElementById('chat-login-btn');
  const inputArea = document.getElementById('chat-input');
  const chatText = document.getElementById('chat-text');
  const chatSend = document.getElementById('chat-send');
  const chatMsgs = document.getElementById('chat-messages');
  const userCount = document.getElementById('chat-users');

  toggleBtn.onclick = () => {
    chatBox.style.display = chatBox.style.display === 'none' ? 'flex' : 'none';
  };

  loginBtn.onclick = () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).catch(alert);
  };

  let currentUser = null;

  auth.onAuthStateChanged(user => {
    if (user) {
      currentUser = user;
      inputArea.style.display = 'flex';
      loginBtn.style.display = 'none';
    } else {
      currentUser = null;
      inputArea.style.display = 'none';
      loginBtn.style.display = 'block';
    }
  });

  chatSend.onclick = () => {
    const text = chatText.value.trim();
    if (!text || !currentUser) return;
    db.ref('chat').push({
      name: currentUser.displayName,
      text: text,
      time: new Date().toISOString()
    });
    chatText.value = '';
  };

  db.ref('chat').limitToLast(50).on('value', snap => {
    chatMsgs.innerHTML = '';
    snap.forEach(child => {
      const msg = child.val();
      const time = new Date(msg.time).toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});
      chatMsgs.innerHTML += `<p><strong>${msg.name}</strong>: ${msg.text} <span class="chat-timestamp">${time}</span></p>`;
    });
    chatMsgs.scrollTop = chatMsgs.scrollHeight;
  });

  const presenceRef = db.ref('presence');
  auth.onAuthStateChanged(user => {
    if (user) {
      const userRef = presenceRef.child(user.uid);
      userRef.set(true);
      userRef.onDisconnect().remove();
    }
  });

  presenceRef.on('value', snap => {
    const count = snap.numChildren();
    userCount.textContent = `(${count} online)`;
  });
</script>
<!-- ===== GLOBAL CHAT WIDGET (END) ===== -->
